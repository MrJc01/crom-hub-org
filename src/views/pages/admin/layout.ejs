<!-- Layout Editor -->
<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Editor de Layout</h1>
      <p class="text-gray-400">Arraste as se√ß√µes para reordenar a landing page</p>
    </div>
    <a
      href="/"
      target="_blank"
      class="px-4 py-2 bg-primary hover:bg-primary-dark rounded-xl transition flex items-center gap-2"
    >
      <span>üåê</span>
      <span>Ver Resultado</span>
    </a>
  </div>

  <!-- Sections List -->
  <div class="glass rounded-2xl p-6 border border-white/10">
    <div id="sections-list" class="space-y-3">
      <% sections.forEach((section, index) => { %>
      <div
        class="bg-white/5 rounded-xl border border-white/10 transition group"
        data-id="<%= section.id %>"
      >
        <div
          class="flex items-center gap-4 p-4 cursor-move hover:bg-white/10 rounded-t-xl"
          draggable="true"
        >
          <div class="text-gray-500 cursor-grab">‚£ø</div>
          <div class="flex-1">
            <p class="font-medium capitalize"><%= section.id %></p>
            <p class="text-sm text-gray-400 truncate"><%= section.title || 'Sem t√≠tulo' %></p>
          </div>
          <label class="flex items-center gap-2 cursor-pointer" onclick="event.stopPropagation()">
            <input type="checkbox" <%= section.enabled !== false ? 'checked' : '' %>
            hx-post="/admin/layout/toggle" hx-vals='{"id": "<%= section.id %>", "enabled": <%=
            !section.enabled %>'}' hx-swap="none" class="w-5 h-5 rounded accent-primary" />
            <span class="text-sm text-gray-400">Ativo</span>
          </label>
        </div>

        <!-- content editor -->
        <div class="px-4 pb-4 border-t border-white/5 pt-3">
          <details class="text-sm text-gray-400">
            <summary class="cursor-pointer hover:text-white transition w-full">
              Editar Texto
            </summary>
            <form hx-post="/admin/layout/update" hx-swap="none" class="mt-3 space-y-3">
              <input type="hidden" name="id" value="<%= section.id %>" />

              <% if (section.title !== undefined) { %>
              <div>
                <label class="block text-xs uppercase font-bold mb-1">T√≠tulo</label>
                <input
                  type="text"
                  name="title"
                  value="<%= section.title %>"
                  class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-white text-sm"
                />
              </div>
              <% } %> <% if (section.subtitle !== undefined) { %>
              <div>
                <label class="block text-xs uppercase font-bold mb-1">Subt√≠tulo</label>
                <input
                  type="text"
                  name="subtitle"
                  value="<%= section.subtitle %>"
                  class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-white text-sm"
                />
              </div>
              <% } %> <% if (section.cta_primary !== undefined) { %>
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-xs uppercase font-bold mb-1">CTA Principal</label>
                  <input
                    type="text"
                    name="cta_primary"
                    value="<%= section.cta_primary %>"
                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-white text-sm"
                  />
                </div>
                <% if (section.cta_secondary !== undefined) { %>
                <div>
                  <label class="block text-xs uppercase font-bold mb-1">CTA Secund√°rio</label>
                  <input
                    type="text"
                    name="cta_secondary"
                    value="<%= section.cta_secondary %>"
                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-white text-sm"
                  />
                </div>
                <% } %>
              </div>
              <% } %>

              <div class="flex justify-end pt-2">
                <button
                  type="submit"
                  class="px-3 py-1 bg-white/10 hover:bg-white/20 text-white text-xs rounded transition"
                >
                  Salvar Texto
                </button>
              </div>
            </form>
          </details>
        </div>
      </div>
      <% }); %>
    </div>
  </div>

  <!-- Instructions -->
  <div class="glass rounded-2xl p-6 border border-white/10">
    <h3 class="font-medium mb-2">üí° Dicas</h3>
    <ul class="text-sm text-gray-400 space-y-1">
      <li>‚Ä¢ Arraste as se√ß√µes para reordenar</li>
      <li>‚Ä¢ Use o checkbox para ativar/desativar se√ß√µes</li>
      <li>‚Ä¢ As altera√ß√µes s√£o salvas automaticamente</li>
    </ul>
  </div>
</div>

<script>
  // Simple drag and drop reordering
  const list = document.getElementById('sections-list');
  let draggedItem = null;

  list.addEventListener('dragstart', (e) => {
    draggedItem = e.target.closest('[draggable]');
    e.dataTransfer.effectAllowed = 'move';
    setTimeout(() => draggedItem.classList.add('opacity-50'), 0);
  });

  list.addEventListener('dragend', () => {
    draggedItem.classList.remove('opacity-50');
    saveOrder();
  });

  list.addEventListener('dragover', (e) => {
    e.preventDefault();
    const target = e.target.closest('[draggable]');
    if (target && target !== draggedItem) {
      const rect = target.getBoundingClientRect();
      const next = e.clientY - rect.top > rect.height / 2;
      list.insertBefore(draggedItem, next ? target.nextSibling : target);
    }
  });

  function saveOrder() {
    const order = [...list.querySelectorAll('[data-id]')].map((el) => el.dataset.id);
    fetch('/admin/layout/reorder', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ order }),
    }).then(() => showToast('Ordem salva!'));
  }
</script>
