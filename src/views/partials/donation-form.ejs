<form
  hx-post="/donate"
  hx-target="#donation-form"
  hx-swap="innerHTML"
  hx-encoding="multipart/form-data"
  class="space-y-6"
  id="donation-form-el"
>
  <% if (typeof error !== 'undefined' && error) { %>
  <div class="p-4 bg-red-500/20 border border-red-500/50 rounded-xl text-red-400 text-sm">
    âš ï¸ <%= error %>
  </div>
  <% } %>

  <!-- Payment Method Selection -->
  <label class="block text-sm text-gray-400 mb-3">Escolha o mÃ©todo de pagamento</label>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6">
    <% Object.entries(config.payments).forEach(([key, provider]) => { %> <% if (provider.enabled) {
    %>
    <button
      type="button"
      class="method-btn flex flex-col items-center justify-center p-4 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition gap-2 <%= key === 'manual' ? 'ring-2 ring-primary border-transparent' : '' %>"
      onclick="selectMethod('<%= key %>', this)"
      data-method="<%= key %>"
    >
      <div class="text-2xl">
        <% if(key === 'stripe') { %> ğŸ’³ <% } %> <% if(key === 'mercadopago') { %> ğŸ¤ <% } %> <%
        if(key === 'abacatepay') { %> ğŸ¥‘ <% } %> <% if(key === 'asaas') { %> ğŸ¦ <% } %> <% if(key
        === 'paypal') { %> ğŸ…¿ï¸ <% } %> <% if(key === 'manual') { %> ğŸ’¸ <% } %>
      </div>
      <span class="text-sm font-medium capitalize"
        ><%= key.replace('mercadopago', 'Mercado Pago').replace('abacatepay', 'AbacatePay') %></span
      >
    </button>
    <% } %> <% }); %>
  </div>
  <input type="hidden" name="method" id="payment-method" value="manual" />

  <!-- Amount Selection -->
  <div>
    <label class="block text-sm text-gray-400 mb-3">Escolha um valor ou digite o seu</label>
    <div class="grid grid-cols-4 gap-3 mb-3">
      <% [10, 25, 50, 100].forEach(val => { %>
      <button
        type="button"
        onclick="document.getElementById('amount').value = <%= val %>"
        class="py-3 rounded-xl bg-white/5 hover:bg-primary hover:text-white border border-white/10 transition font-medium"
      >
        R$ <%= val %>
      </button>
      <% }) %>
    </div>
    <div class="relative">
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-medium">R$</span>
      <input
        type="number"
        name="amount"
        id="amount"
        min="5"
        step="0.01"
        placeholder="0,00"
        required
        class="w-full bg-white/5 border border-white/10 rounded-xl py-4 pl-12 pr-4 text-white text-xl font-medium placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
      />
    </div>
  </div>

  <!-- Dynamic Payment Details -->
  <% Object.entries(config.payments).forEach(([key, provider]) => { %> <% if (provider.enabled) { %>
  <div
    id="details-<%= key %>"
    class="method-details <%= key === 'manual' ? '' : 'hidden' %> space-y-4 pt-4 border-t border-white/10 mt-4"
  >
    <% if (key === 'manual') { %>
    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700">
      <p class="text-sm text-gray-400 mb-1">Chave Pix:</p>
      <code
        class="block bg-black/30 p-2 rounded text-lg font-mono text-white mb-2 select-all cursor-pointer"
        ><%= provider.pix_key || 'email@example.com' %></code
      >
      <p class="text-xs text-gray-500">
        <%= provider.instructions || 'Envie o comprovante para confirmar.' %>
      </p>
    </div>
    <div>
      <label class="block text-sm text-gray-400 mb-2">Comprovante</label>
      <input
        type="file"
        name="proof"
        accept="image/*,.pdf"
        class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20"
      />
    </div>
    <% } else { %>
    <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 flex items-center gap-3">
      <span class="text-2xl">â„¹ï¸</span>
      <p class="text-sm text-blue-200">
        VocÃª serÃ¡ redirecionado para o <strong><%= key %></strong> para finalizar o pagamento de
        forma segura.
      </p>
    </div>
    <% } %>
  </div>
  <% } %> <% }); %>

  <!-- Message -->
  <div>
    <label class="block text-sm text-gray-400 mb-2">Deixe uma mensagem (opcional)</label>
    <textarea
      name="message"
      placeholder="Obrigado por manter o projeto..."
      maxlength="200"
      rows="3"
      class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition resize-none"
    ></textarea>
  </div>

  <!-- Email -->
  <div>
    <label class="block text-sm text-gray-400 mb-2">Seu email (opcional)</label>
    <input
      type="email"
      name="email"
      placeholder="seu@email.com"
      class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-white placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
    />
    <p class="text-xs text-gray-500 mt-2">
      Deixe em branco para doar anonimamente. Com email, vocÃª recebe um @handle Ãºnico.
    </p>
  </div>

  <!-- Submit -->
  <button
    type="submit"
    class="w-full py-4 bg-gradient-to-r from-primary to-purple-600 hover:from-primary-dark hover:to-purple-700 text-white font-semibold rounded-xl transition transform hover:scale-[1.02] flex items-center justify-center gap-3 text-lg"
  >
    <span>ğŸ’–</span>
    <span>Completar DoaÃ§Ã£o</span>
  </button>

  <p class="text-center text-gray-500 text-sm">
    ğŸ”’ Seus dados estÃ£o seguros â€¢ TransaÃ§Ã£o 100% transparente
  </p>

  <script>
    function selectMethod(method, btn) {
      document.getElementById('payment-method').value = method;

      // Update buttons
      document.querySelectorAll('.method-btn').forEach((b) => {
        b.classList.remove('ring-2', 'ring-primary', 'border-transparent');
        // b.classList.add('bg-white/5');
      });
      btn.classList.add('ring-2', 'ring-primary', 'border-transparent');
      // btn.classList.remove('bg-white/5'); // Optional visual toggle

      // Toggle details
      document.querySelectorAll('.method-details').forEach((el) => el.classList.add('hidden'));
      const details = document.getElementById(`details-${method}`);
      if (details) {
        details.classList.remove('hidden');
      }
    }
  </script>
</form>
